@using Tennis.Common.Extensions
@model Tennis.ViewModels.Competitions.CompetitionViewModel
@{
    ViewData["Title"] = "Competition";

    var competition = Model.Competition;
}

@section scripts
{
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script>
        "use strict";

        (function($) {
            var url = $.validator.format("/clubs/{0}/teams");

            var emptyOption = function(elementId) {
                var $option = $("<option></option>")
                    .attr("value", "")
                    .text("Select Team");
                $("#" + elementId).empty().append($option);
            };

            var appendTeam = function(elementId, team) {
                var $option = $("<option></option>")
                    .attr("value", team.teamId)
                    .text(team.name);
                $("#" + elementId).append($option);
            };

            var appendTeams = function(elementId, teams) {
                $.each(teams,
                    function(i, team) {
                        appendTeam(elementId, team);
                    });
            };

            $("#Club")
                .change(function() {
                    emptyOption("club-team");

                    var clubId = $(this).val();
                    if (clubId === "") {
                        return;
                    }

                    $.getJSON(url(clubId),
                        function(teams) {
                            appendTeams("club-team", teams);
                        });
                });
        })(jQuery);
    </script>
}

<div class="row">
    <h2>Competition Details</h2>

    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <ul>
            <li>Name: @competition.Name</li>
            <li>Year: @competition.Year</li>
            <li>Season: @competition.Season</li>
            <li>Day: @competition.Day</li>
            <li>Type: @competition.Type</li>
            <li>Grade: @competition.Grade</li>
            <li>Level: @competition.Level</li>
            <li><a href="@competition.TrolsUrl" target="_blank">Official TROLS page</a></li>
        </ul>
    </div>

    <h2>Participating Teams</h2>

    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <div class="table-responsive">
            <table class="table">
                <tr>
                    <th>Team</th>
                    <th>Address</th>
                    <th>Supervisor</th>
                </tr>
                @if (competition.Teams.IsNullOrEmpty())
                {
                    <tr>
                        <td colspan="3">There is no participating team</td>
                    </tr>
                }
                else
                {
                    foreach (var team in competition.Teams)
                    {
                        <tr>
                            <td><a asp-controller="Club" asp-action="GetTeam" asp-route-clubId="@team.ClubId" asp-route-teamId="@team.TeamId">@team.Club.Name @(string.IsNullOrWhiteSpace(team.Tag) ? string.Empty : $"- {team.Tag}")</a></td>
                            <td>@team.Club.Venue.FullAddress</td>
                            <td>@team.Club.Manager (@string.Join(" | ", team.Club.Contacts))</td>
                        </tr>
                    }
                }
            </table>
        </div>

        @if (User.Identity.IsAuthenticated)
        {
            <form class="form-inline" asp-controller="Competition" asp-action="AddTeam" asp-route-competitionId="@competition.CompetitionId" method="post">
                <div class="form-group">
                    <select class="form-control" style="display: inline-block !important" asp-for="Club" asp-items="@Model.Clubs"></select>
                    <select class="form-control" style="display: inline-block !important" name="Team" id="club-team">
                        <option value="">Select Team</option>
                    </select>
                    <button type="submit" class="btn btn-primary">Add Team</button>
                </div>
            </form>
        }
    </div>


    <h2>Fixtures</h2>

    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        @*<ul>
                @if (competition.Fixtures.IsNullOrEmpty())
                {
                    <li>There is no fixture</li>
                }
                else
                {
                    foreach (var fixture in competition.Fixtures)
                    {
                        <li>Round @fixture.Week.ToString("00"): @fixture.DateScheduled.ToString("dd/MM/yyyy HH:mm") at @fixture.Venue.FullAddress [<a asp-controller="Competition" asp-action="GetFixture" asp-route-competitionId="@fixture.CompetitionId" asp-route-fixtureId="@fixture.FixtureId">Result</a>]</li>
                    }
                }
            </ul>*@
    </div>

    @if (User.Identity.IsAuthenticated)
    {
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <a asp-controller="Competition" asp-action="AddFixture">Add Fixture</a>
        </div>
    }
</div>